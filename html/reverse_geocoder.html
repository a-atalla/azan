<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html style="height:100%" xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" dir="rtl">
  <head>
    <meta  http-equiv="content-type" content="text/html; charset=UTF-8"/>
    <title>Google Maps JavaScript API Example: 	Reverse Geocoder [Edited for Azan]</title>
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAzr2EBOXUKnm_jVnk0OJI7xSosDVG8KKPE1-m51RBrvYughuyMxQ-i1QfUnH94QxWIa6N4U6MouMmBA" 
            type="text/javascript"></script>
   <script type="text/javascript">

    var map;
    var geocoder;
    var address;
    var sel_address;
    var sel_city;
    var sel_country;
    var sel_longitude;
    var sel_latitude;

    function initialize() {
      map = new GMap2(document.getElementById("map_canvas"));
      map.setCenter(new GLatLng(30.05,31.25), 2);
      map.setUIToDefault();

      GEvent.addListener(map, "click", getAddress);
      geocoder = new GClientGeocoder();

      addKabaIcon();
    }
    
    function addKabaIcon() {
      addIcon('../images/kaba.png',21.423333, 39.823333);
    }

    function addIcon(icon, lat, lon) {
      var newIcon = new GIcon();
      newIcon.image = icon;
      newIcon.iconSize = new GSize(20, 20);
      newIcon.shadowSize = new GSize(22, 20);
      newIcon.iconAnchor = new GPoint(6, 20);

      var point = new GLatLng(lat,lon);
      var marker = new GMarker( point, { icon: newIcon} ); 
      map.addOverlay(marker);
    }
    
    function getAddress(overlay, latlng) {
      if (latlng != null) {
        address = latlng;
        geocoder.getLocations(latlng, showAddress);
      }
    }

    function showAddress(response) {
      map.clearOverlays();
      if (!response || response.Status.code != 200) {
        alert("Status Code:" + response.Status.code);
      } else {
        place = response.Placemark[0];
        point = new GLatLng(place.Point.coordinates[1],
                            place.Point.coordinates[0]);
        marker = new GMarker(point);
        map.addOverlay(marker);
        //marker.openInfoWindowHtml(
        //'<b>orig latlng:</b>' + response.name + '<br/>' + 
        //'<b>latlng:</b>' + place.Point.coordinates[1] + "," + place.Point.coordinates[0] + '<br>' +
        //'<b>Status Code:</b>' + response.Status.code + '<br>' +
        //'<b>Status Request:</b>' + response.Status.request + '<br>' +
        //'<b>Address:</b>' + place.address + '<br>' +
        //'<b>Accuracy:</b>' + place.AddressDetails.Accuracy + '<br>' +
        //'<b>Country code:</b> ' + place.AddressDetails.Country.CountryNameCode);
        setSelectedData();
      }
      
    }

    function setSelectedData() {
      addKabaIcon();
      sel_address = place.address;
      sel_longitude = place.Point.coordinates[0];
      sel_latitude = place.Point.coordinates[1];
    }

    // showLocation() is called when you click on the Search button
    // in the form.  It geocodes the address entered into the form
    // and adds a marker to the map at that location.
    function showLocation() {
      var address = document.forms[0].q.value;
      geocoder.getLocations(address, addAddressToMap);
    }

    function addAddressToMap(response) {
      map.clearOverlays();
      if (!response || response.Status.code != 200) {
        alert("Sorry, we were unable to geocode that address");
      } else {
        place = response.Placemark[0];
        point = new GLatLng(place.Point.coordinates[1],
                            place.Point.coordinates[0]);
        marker = new GMarker(point);
        map.addOverlay(marker);
        //marker.openInfoWindowHtml(place.address + '<br>' +
        //  '<b>Country code:</b> ' + place.AddressDetails.Country.CountryNameCode);
        setSelectedData();
      }
    }

    function getMapAddress() {
      return sel_address;
    }

    function getMapLongitude() {
      return sel_longitude;
    }

    function getMapLatitude() {
      return sel_latitude;
    }

    </script>
    <form action="#" onsubmit="showLocation(); return false;">
      <p>
        <b>بحث عن عنوان:</b>
        <input type="text" name="q" value="" class="address_input" size="40" />
        <input type="submit" name="find" value="بحث" />

      </p>
    </form>
  </head>
  <body onload="initialize()" style="height:100%;margin:0">
    <div id="map_canvas" style="width: 100%; height: 100%;"></div>
  </body>
</html>

